<!DOCTYPE html>

<script type="text/javascript" src="jquery-3.4.1.min.js"></script>

<script>
	function build_table(list) {
       var mybody = document.getElementsByTagName("body")[0];
       var IP_Table = document.createElement("table");
	   IP_Table.id = "IP_Status_Table";
       var mytablebody = document.createElement("tbody");

       for(var row = 0; row < list.length; row++) {
           mycurrent_row=document.createElement("tr");
           for(var col = 0; col < 2; col++) {
               mycurrent_cell = document.createElement("td");
               if(col===0) currenttext = document.createTextNode(list[row]);
			   if(col===1) currenttext = document.createTextNode("PROCESSING ");
               mycurrent_cell.appendChild(currenttext);
               mycurrent_row.appendChild(mycurrent_cell);
           }
           mytablebody.appendChild(mycurrent_row);
       }
       IP_Table.appendChild(mytablebody);
       mybody.appendChild(IP_Table);
    }

	function ip_response(ip, timeout, return_delay)
	{
		var myTable = document.getElementById("IP_Status_Table");
		if(myTable != null)
		{
			for(var i = 0; i< myTable.rows.length; i++)
			{
				if(myTable.rows[i].cells[0].innerHTML===ip)
				{
					if(timeout>return_delay)
					{
						myTable.rows[i].cells[1].style.background = "rgb(0,255,0)";
						myTable.rows[i].cells[1].innerHTML="CONNECTED";
					}
					else 
					{
						myTable.rows[i].cells[1].style.background = "rgb(255,0,0)";
						myTable.rows[i].cells[1].innerHTML="FAILED";
					}
				};
				/*for(var j = 0; j<myTable.rows[i].cells.length; j++)
				{
					console.log(myTable.rows[i].cells[j].innerHTML);
				};*/
			};
		};
	};
	  
	function test_ip(ip, timeout, return_delay, callback){
		var timestart = new Date().getTime();
		$.ajax({ 
			url: "https://"+ip,
			data: timestart,
			error: function(request, error){
				return_delay = new Date().getTime()-timestart;
				callback(ip, timeout, return_delay);
			},
			dataType: "json",
			timeout: timeout});
	};

</script>	

<HTML lang="en">
	<HEAD>
		<TITLE>SiteMap IP Health</TITLE>
	</HEAD>
	<BODY>
	</BODY>

	<script> 
		var iplist;
		
		iplist = [
			"127.0.0.1",
			"192.168.1.98",
			"192.168.1.1",
			"192.168.1.101"];
		build_table(iplist);
		var timeout = 5000;

		for(var i =0; i<iplist.length; i++)
		{
			test_ip(iplist[i], timeout, iplist[i].delay, ip_response);
		};


		/*var a = new XMLHttpRequest();
		a.onreadystatechange = function () {

			if (a.readyState === a.HEADERS_RECEIVED) {
				a.abort();
				console.log(new Date - abc);
			}
		};

		var abc = new Date;

		a.open("GET", "https://192.168.1.92");
		a.send(null);
		console.log("END TWO");*/

		
		
	</script>
	<noscript>Current settings do not support JavaScript.</noscript>
</HTML>
